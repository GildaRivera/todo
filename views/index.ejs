<!DOCTYPE html>
<html lang="en" class="h-100">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="" />
  <meta name="author" content="JD" />
  <title>DSU Chat</title>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">

  <style>
    img {
      max-height: 60vh;
      height: auto;
      width: auto;
    }

    .input1 {
      box-shadow: none !important;
      background-color: #fff !important;
      border-color: #dbdbdb !important;
      border-radius: 4px !important;
      color: #363636 !important;
      border-width: 0;
    }


    .carousel-control-prev,
    .carousel-control-next {
      max-height: 75%;
    }
  </style>
</head>

<body class="">


  <div class="container is-max-desktop">
    <div class="notification is-primary">
      <%- include('./form'); %>

        <div class="table-container">
          <table class="table is-hoverable is-fullwidth">
            <thead>

              <tr>

                <th>Task</th>

                <th>Actions</th>

              </tr>
            </thead>

            <tbody>


              <% data.forEach(function(element){ %>
                <tr>
                  <td>
                    <div class="is-flex">
                      <input type="checkbox" value="<%= element.status %>"
                        onchange="checkStatus(<%= JSON.stringify(element) %>)" id=<%=element.id %>
                      onclick="onUpdate(<%=JSON.stringify(element) %> )" style="position: relative; top:2vh" >
                        <input class="input input1" placeholder="<%=element.task %>" value="<%=element.task %>"
                          style="position: relative; width: 90%; left: 1vw;" disabled="false" name=<%=element.id %>>
                        <div class="is-flex">
                          <button class="button is-white editIcons"
                            onclick="onTaskEdit(1,<%=JSON.stringify(element) %>)">
                            <i class="fa-solid fa-check"></i></button>
                          <button class="button is-white editIcons"
                            onclick="onTaskEdit(2,<%=JSON.stringify(element) %>)">
                            <i class="fa-solid fa-x"></i></button>
                        </div>
                    </div>
                    <!--               
                    <input class="input is-primary" placeholder="Primary input" value=<%=element.status %> > -->
                  </td>

                  <td>

                    <button class="button  is-white" onclick="onDelete(<%= JSON.stringify(element.id) %>)">
                      <i class="fa-solid fa-trash"></i></button>

                    <button class="button is-white" onclick="onEdit(<%= JSON.stringify(element.id) %>)">
                      <i class="fa-solid fa-pen"></i></button>



                  </td>
                </tr>
                <% }) %>


            </tbody>

          </table>





        </div>

    </div>
  </div>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  <script>

    function onDelete(e) {
      $.ajax({
        url: `/task/${e}`,
        type: 'DELETE',
        contentType: 'aplication/json',

      }).then((v) => {
        window.location.href = '/home'
      })
    }
    function onEdit(e) {
      document.getElementsByName(e)[0].disabled = false
      document.getElementsByName(e)[0].className = "input is-primary"

    }
    function onTaskEdit(action, element) {
      if (action == 1) {
        var task = document.getElementsByName(element.id)[0].value
        console.log(task)
        element.task = task
        $.ajax({
          url: `/task/${element.id}`,
          type: 'PUT',
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          data: JSON.stringify({ task: task, status: element.status }),
          processData: false,
        }).then((v) => {
          window.location.href = '/home'
        })
      } else {
        document.getElementsByName(element.id)[0].className = "input1 input"
        document.getElementsByName(element.id)[0].disabled = true
        document.getElementsByName(element.id)[0].value = element.task
      }

    }
    function onUpdate(e) {
      console.log(e)
      if (e.status == 'pending') {
        e.status = 'closed'
      } else {
        e.status = 'pending'
      }
      // $.ajax({
      //   url: `/task/${e.id}`,
      //   type: 'PUT',
      //   contentType: "application/json; charset=utf-8",
      //   dataType: "json",
      //   data: JSON.stringify({ task: e.task, status: e.status }),
      //   processData: false,
      // }).then((v) => {
      //   window.location.href = '/home'
      // })
    }

    function checkStatus(e) {
      console.log("--")
      if (e.status == 'closed') {

        document.getElementById(e.id).setChecked = true


      } else {
        document.getElementById(e.id).setChecked = false

      }
    }

  </script>
  <script>
    $(document).ready(function () {


      // // Set initial state
      // $('#textbox1').val('no');

      // // Returns yes or no in textbox1
      // // when checked and unchecked
      // $('#checkbox1').click(function() {
      //     if ($("#checkbox1").is(":checked") == true) {
      //         $('#textbox1').val('yes');
      //     } else {
      //         $('#textbox1').val('no');
      //     }
      // });




    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"></script>
  <script>
    let data = '<% data.forEach(i => { %><li> <strong><%= i.task %></strong>  </li>     <% }); %>'

  </script>

  <script src="https://kit.fontawesome.com/ea57e7377a.js" crossorigin="anonymous"></script>
</body>

</html>